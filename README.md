# Основы работы с Git

---

## Знакомство с Git

### Командная строка

**Командная строка** — один из основных инструментов взаимодействия с компьютером.

В macOS и Linux есть программа Terminal. Чтобы ее найти, можно использовать комбинацию горячих клавиш:

* для Linux – ```Ctrl+Alt+T```;
* для macOS – ```Cmd+Space```, затем ввести ```terminal```.

**Git Bash** — это специальный консольный инструмент для Windows. Его можно скачать вместе с пакетом **Git for Windows** можно на [странице официального сайта Git](https://git-scm.com/download/win), из категории **Standalone Installer**.

### Настройка Git

**Git** — это система контроля версий, которая помогает отслеживать изменения в проекте.

Если вы пользователь Windows, то вы уже установили Git в составе пакета Git for Windows вместе с командной строкой. Чтобы убедиться в этом, откройте консоль и выполните эту команду.

```bash
$ git version
```

Если Git установлен правильно, консоль выведет его текущую версию.

Для **установки Git на macOS** существует два способа.

**Первый способ**. Откройте консоль и выполните команду ```/usr/bin/git```. Она запустит установщик. Нажмите **Install** и дождитесь окончания установки.

**Второй способ**. Используйте **менеджер пакетов Homebrew**. Чтобы его установить, скопируйте команду установки с [официального сайта Homebrew](https://brew.sh/). Найдите программу Terminal в поиске Spotlight или в списке программ. Вставьте скопированный текст в окно терминала и нажмите Enter.

Установите Git с помощью Homebrew. Скопируйте и введите в терминал следующую команду

```bash
$ brew install git
```

Проверьте установку. Для этого откройте терминал и введите эту команду

```bash
$ git version
```

Если на экран выводится текущая версия Git, значит, установка прошла успешно.

**Для установки Git на Linux** нужно использовать терминал. Перейдите на [официальный сайт Git](https://git-scm.com/download/linux) и выберите команду установки для своей версии Linux. Скопируйте её в программу Terminal и нажмите ```Enter```.

После успешной установки введите команду для проверки

```bash
$ git version
```

### Работа с файлом настройки .gitconfig

Указать электронную почту и имя можно с помощью команды ```git config``` с ключом ```-global```.

```bash
$ git config --global user.name "User Namovich"
# имя или ник нужно написать латиницей и в кавычках
```

```bash
$ git config --global user.email username@yandex.ru
# здесь нужно указать свой настоящий email
```

Все глобальные настройки Git хранит в файле ```.gitconfig``` в домашней директории.

```bash
$ cat ~/.gitconfig
```

Другой способ проверки – вывести содержимое файла конфигурации Git той же командой ```git config``` с флагом ```--list```.

```bash
$ git config --list
```

---

## Первый коммит

### Инициализируем репозиторий

**Инициализировать репозиторий** можно с помощью команды ```git init```.

```bash
$ cd ~/dev/first-project # перешли в нужную папку
$ git init # создали репозиторий
```

**Проверить статус**, или **состояние**, репозитория поможет команда ```git status```.

```bash
$ git status
```

Если вы ошиблись и случайно инициализировали не ту папку, можно «**разгитить**» её — удалить скрытую подпапку ```.git```.


```bash
$ cd <папка с репозиторием> # перешли в папку
$ rm -rf .git # удалили подпапку .git
```

### Добавляем файлы в репозиторий

С точки зрения системы контроля версий любой код — это всего лишь текстовый файл.

Команда ```git add``` позволяет **подготовить файл к сохранению**.

```bash
$ git add todo.txt
$ git add readme.txt
$ git status
```

Команда ```git add --all``` **подготовит к сохранению** сразу **все файлы**.

```bash
$ git add --all # подготовили к сохранению все файлы в репозитории
```

С помощью ```git add .``` можно **добавить в репозиторий текущую папку со всеми файлами**.

```bash
$ git add . # добавить всю текущую папку
```

### Делаем первый коммит

Само сохранение, или фиксацию состояния файлов, называют **коммитом**. «**Сделать коммит**» значит сохранить текущую версию файла. Коммит гарантирует, что изменения будут сохранены в истории и при необходимости к ним можно будет «откатиться».

**Коммит** можно **сделать** с помощью команды ```git commit```.

```bash
$ git commit -m 'Мой первый коммит!'
```

Ключ ```-m``` позволяет присвоить коммиту сообщение. Такие сообщения должны быть информативными, т. е. чётко описывать изменения.
В коммит попадает то, что было предварительно добавлено «в корзину», или «в кадр», перед коммитом.

Разница между ```git add``` и ```git commit```:

1. Сначала команда ```git add``` сообщает Git, какие именно файлы нужно сохранить и какую их версию.

2. Затем с помощью команды ```git commit``` происходит само сохранение.

### Просматриваем историю коммитов

Просмотреть историю коммитов мы можем с помощью команды ```git log```.

По умолчанию git log выводит коммиты в обратном хронологическом порядке — последние коммиты оказываются первыми сверху.

---

## Работа с GitHub

### Знакомство с GitHub

[**GitHub**](https://github.com/) — платформа для хранения IT-проектов и совместной работы над ними с использованием Git.

На GitHub можно завести аккаунт и вместе со своей командой работать над любыми задачами. Можно создавать проекты разных типов:
* приватный — только для вас;
* командный — только для членов команды;
* публичный — будет виден всем.

Также можно присоединиться к чужому **open source проекту** и работать над ним вместе с другими людьми со всего мира. 

Git и GitHub — это два разных проекта, которые развиваются независимо друг от друга.

Git:
* консольный инструмент для работы с локальными и удалёнными репозиториями;
* проект с открытым исходным кодом.

GitHub:
* платформа для размещения удалённых репозиториев;
* принадлежит компании Microsoft.

### Регистрация на GitHub

1. В правом верхнем углу [главной страницы GitHub]() нажмите на **Sign up**.
2. Введите адрес электронной почты, придумайте пароль и введите имя пользователя.
3. Платформа спросит, хотите ли вы получать на почту рассылку с обновлениями и новостями. Введите ```y```, если хотите получать рассылку, или ```n```, если не хотите.
4. Нажмите кнопку **Continue**.
5. Пройдите капчу.
6. После прохождения капчи нажмите **Create account**.
7. Введите короткий код, который будет отправлен на указанный вами почтовый адрес.

### Создаём удалённый репозиторий

Инструкция по созданию репозитория на GitHub

1. Зайдите в свой профиль по ссылке [https://github.com/username](https://github.com/username), где ```username``` — имя, которое вы указали при регистрации.
2. Создайте репозиторий. Для этого перейдите на вкладку **Repositories**, а затем нажмите на зелёную кнопку **New** справа.
3. Открылось окно создания нового репозитория. Назовите его ```first-project```. Название удалённого репозитория необязательно должно совпадать с именем папки проекта у вас на компьютере.
4. Нажмите на зелёную кнопку **Create repository** внизу.

### Что такое SSH. Генерируем SSH-ключ

Чтобы получить доступ к репозиторию на GitHub, вам нужно предоставить ключ, который подтверждает вашу личность и права на чтение или изменение данных. Без этого ключа доступ будет ограничен.

Когда компьютеры обмениваются данными в сети, они следуют **сетевым протоколам** — правилам обмена данными между компьютерами.

Один из наиболее распространённых сетевых протоколов — **SSH**. Он обеспечивает безопасный обмен данными в сети.

SSH использует пару ключей для обеспечения безопасности — публичный и приватный:
* **Приватный ключ** хранится только на вашем компьютере и не должен передаваться кому-либо ещё. Он используется для расшифровки данных.
* **Публичный ключ** доступен всем и используется для шифрования данных. Они могут быть расшифрованы парным приватным ключом.

Эти два ключа связаны и образуют **SSH-пару**, которая является вашим виртуальным идентификатором в GitHub и позволяет получить доступ к GitHub-репозиторию.

Проверить наличие созданных SSH-ключей можно с помощью следующих команд:
* ```ls -a ~/.ssh``` — эта команда покажет содержимое папки ```.ssh```;
* ```ls -la ~/.ssh``` — эта команда покажет содержимое папки ```.ssh``` в виде списка файлов.

По умолчанию директория с SSH-ключами находится в домашней директории пользователя.

Инструкция по генерации SSH-ключа:
1. Для генерации SSH-пары можно использовать программу ssh-keygen. Откройте терминал и введите следующую команду.

```bash
$ ssh-keygen -t ed25519 -C "электронная почта, к которой привязан ваш аккаунт на GitHub"
```

Если вы видите сообщение об ошибке, то, скорее всего, ваша система не поддерживает алгоритм шифрования ed25519. Используйте другой алгоритм.

```bash
$ ssh-keygen -t rsa -b 4096 -C "электронная почта, к которой привязан ваш аккаунт на GitHub"
```

2. Укажите место хранения ключей. Нажмите Enter, чтобы сделать домашний каталог пользователя путём по умолчанию.
**macOS**:
```bash
> Enter a file in which to save the key (/Users/you/.ssh/id_rsa): [Press enter]
```

**Windows**:
```bash
> Enter a file in which to save the key (C:\Users\<имя_пользователя>\.ssh\):[Press enter]
```

3. Программа запросит кодовую фразу для доступа к SSH-ключу. Вы можете оставить поле пустым. Для этого нажмите Enter, а затем ещё раз Enter для подтверждения.

```bash
> Enter passphrase (empty for no passphrase): [Type a passphrase]
> Enter same passphrase again: [Type passphrase again]
```

4. Чтобы проверить, что ключи действительно сгенерировались, вызовите эту команду.

```bash
ls -a ~/.ssh
```

На экране должны появиться два файла — один с расширением ```.pub```, другой — без. Файл в ```.pub``` — публичный, им можно делиться с веб-сайтами или коллегами. Файл без расширения ```.pub``` — приватный. Ни в коем случае не передавайте его никому! 

### Инструкция по связыванию SSH-ключа и GitHub-аккаунта

1. Скопируйте содержимое файла с публичным ключом в буфер обмена.

**macOS:**

```bash
# скопировать содержимое ключа в буфер обмена:
$ pbcopy < ~/.ssh/id_rsa.pub
# для ed25519:
$ pbcopy < ~/.ssh/id_ed25519.pub
```

**Windows:**

```bash
# скопировать содержимое ключа в буфер обмена:
$ clip < ~/.ssh/id_rsa.pub
# для ed25519:
$ clip < ~/.ssh/id_ed25519.pub
```

2. Перейдите на [GitHub](https://github.com/) и выберите пункт **Settings** в меню аккаунта.
3. В меню слева нажмите на пункт **SSH and GPG keys**.
4. В открывшейся вкладке выберите **New SSH key**.
5. В поле **Title** напишите название ключа. Например, **Personal key**.
6. В поле **Key type** должно быть **Authentication Key**.
7. В поле **Key** скопируйте ваш ключ из буфера обмена.
8. Нажмите на кнопку **Add SSH key**.
9. Проверьте правильность ключа с помощью следующей команды.
```bash
$ ssh -T git@github.com
```

### Связываем локальный и удалённый репозитории

1. Перейдите на страницу удалённого репозитория, выберите тип SSH и скопируйте URL.
2. Откройте консоль, перейдите в каталог локального репозитория и введите команду ```git remote add```.

```bash
$ cd ~/dev/first-project
$ git remote add origin git@github.com:%ИМЯ_АККАУНТА%/first-project.git
```

```origin``` — стандартный псевдоним, с помощью которого можно обращаться к главному удалённому репозиторию.

3. Убедитесь, что репозитории связаны, с помощью следующей команды.

```bash
$ git remote -v
origin    git@github.com:%ИМЯ_АККАУНТА%/%ИМЯ-ПРОЕКТА%.git (fetch)
origin    git@github.com:%ИМЯ_АККАУНТА%/%ИМЯ-ПРОЕКТА%.git (push)
```

### Синхронизируем локальный и удалённый репозитории

Каждый коммит сохраняет актуальное состояние файлов. Сами же коммиты хранятся в **ветках**.

Самая первая ветка в репозитории появляется автоматически и называется ```main``` или ```master```.

За загрузку содержимого локального репозитория на GitHub отвечает команда ```git push```.

```bash
$ git push -u origin main # Если команда приведёт к ошибке, попробуйте 
                          # заменить main на master.
```

Если вы указывали кодовую фразу при настройке SSH-ключей, её нужно будет ввести.

В дальнейшем при работе с удалённым репозиторием флаг ```-u``` можно опустить и писать просто ```git push```.

### Файл README.md

Как правило, в файле ```README.md``` проекта можно найти следующую информацию:
1. Название проекта и его краткое описание: кем создан, для чего, какие решает задачи и какие закрывает проблемы.
2. Технологии, которые применяются в проекте. В чём его отличие от аналогичных.
3. Документация проекта — подробная инструкция о том, что представляет собой проект.
4. Планы проекта, если они есть.

Пример файла ```README.md``` для Git на GitHub: [https://github.com/git/git/blob/master/README.md](https://github.com/git/git/blob/master/README.md)

Преимущество ```README.md``` в том, что средства командной работы (такие, как GitHub) могут отображать его содержимое в браузере в виде удобной разметки. Для этого нужно не просто залить текст, но и настроить шрифт, заголовки и отступы с помощью markdown. **Маркда́ун** — это специальный язык разметки. Он позволяет красиво отформатировать текстовый документ.

Руководства по маркдауну:
* [шпаргалка на GitHub](https://gist.github.com/fomvasss/8dd8cd7f88c67a4e3727f9d39224a84c);
* [гайд](https://www.markdownguide.org/cheat-sheet/).

---

## Навигация по коммитам. Статусы файлов

### Хеш – идентификатор коммита

Git преобразует информацию о коммитах с помощью алгоритма SHA-1 и для каждого из них рассчитывает уникальный идентификатор — **хеш**.

**Хеш** — основной идентификатор коммита и позволяет узнать его автора, дату и содержимое закоммиченных файлов.

Все хеши, а также таблицу соответствий ```хеш → информация о коммите``` Git хранит в папке ```.git```.


### Исследуем лог

После вызова ```git log``` появляется список коммитов.

Получить **сокращённый лог** можно с помощью команды ```git log с флагом --oneline```. В терминале появятся только первые несколько символов хеша каждого коммита и их комментарии.

В сокращённом логе выводятся **сокращённые хеши** — их можно использовать точно так же, как и полные.


### HEAD — всему голова

Файл ```HEAD``` — один из служебных файлов папки ```.git```. Он указывает на коммит, который сделан последним (то есть на самый новый).

Внутри ```HEAD``` — ссылка на служебный файл: ```refs/heads/master``` (или ```refs/heads/main``` в зависимости от названия ветки). Если заглянуть в этот файл, можно увидеть хеш последнего коммита.

Многие команды Git принимают в качестве параметра хеш коммита. Если нужно передать последний коммит, то вместо его хеша можно просто написать слово ```HEAD``` — Git поймёт, что вы имели в виду последний коммит.


### Статусы файлов в Git

Одна из ключевых задач Git – отслеживать изменения файлов в репозитории. Для этого каждый файл помечается каким-либо **статусом**. Рассмотрим основные.

* ```untracked```.

Новые файлы в Git-репозитории помечаются как ```untracked```, то есть **неотслеживаемые**. Git «видит», что такой файл существует, но не следит за изменениями в нём. У untracked-файла нет предыдущих версий, зафиксированных в коммитах или через команду ```git add```.

* ```staged```.

После выполнения команды ```git add``` файл попадает в **staging area**, то есть в список файлов, которые войдут в коммит. В этот момент файл находится в состоянии ```staged```.

Staging area также называют **index** или **cache**, а состояние файла ```staged``` иногда называют ```indexed``` или ```cached```.

* ```tracked```.

В состояние ```tracked``` попадают файлы, которые уже были зафиксированы с помощью ```git commit```, а также файлы, которые были добавлены в staging area командой ```git add```. То есть все файлы, в которых Git так или иначе отслеживает изменения.

* ```modified```.

Состояние ```modified``` означает, что Git сравнил содержимое файла с последней сохранённой версией и нашёл отличия. Например, файл был закоммичен и после этого изменён.

Для файлов в состояниях ```staged``` и ```modified``` обычно не указывают, что они также ```tracked```, потому что это состояние подразумевается.

Типичный **жизненный цикл** файла в Git:

1.	Файл только что создали. Git ещё не отслеживает содержимое этого файла. Состояние: ```untracked```.
2.	Файл добавили в staging area с помощью ```git add```. Состояние: ```staged``` (+ ```tracked```).
* Возможно, изменили файл ещё раз. Состояния: ```staged```, ```modified``` (+ ```tracked```). Обратите внимание: ```staged``` и ```modified``` у одного файла, но у разных его версий.
* Ещё раз выполнили ```git add```. Состояние: ```staged``` (+ ```tracked```).
3.	Сделали коммит с помощью ```git commit```. Состояние: ```tracked```.
4.	Изменили файл. Состояние: ```modified``` (+ ```tracked```).
5.	Снова добавили в staging area с помощью ```git add```. Состояния: ```staged``` (+ ```tracked```).
6.	Сделали коммит. Состояния: ```tracked```.
7.	Повторили пункты  4—7 много-много раз.


### Как читать git status

Команда ```git status``` показывает только следующие состояния файлов:

* ```staged``` (```Changes to be committed``` в выводе ```git status```);
* ```modified``` (```Changes not staged for commit```);
* ```untracked``` (```Untracked files```).